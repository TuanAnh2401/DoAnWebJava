<body th:fragment="partialSetting" xmlns:th="http://www.thymeleaf.org">
<script th:inline="javascript">
    function OnBegin() {
        $('#load_page').html('Đang lưu...');
    }
    function OnSuccess(rs) {
        $('#load_page').html('');
    }
    function OnFailure(rs) {

    }
</script>

<form th:action="@{/admin/settingSystem/add}" method="post" th:onsubmit="'return false;'" th:fragment="form">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <div class="tab-content">
            <div class="active tab-pane" id="activity">
              <div class="form-group">
                <label>Tiêu đề trang</label>
                <input type="text" name="settingTitle" class="form-control" />
              </div>
              <div class="form-group">
                <label>Logo</label>
                <div class="input-group">
                  <div class="custom-file">
                    <input type="text" id="settingLogo" name="settingLogo" class="form-control" />
                  </div>
                  <div class="input-group-append">
                    <input type="button" value="Tải ảnh" id="ckfinder-popup-1" />
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label>Số điện thoại:</label>
                <input type="text" name="settingHotline" class="form-control" />
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="text" name="settingEmail" class="form-control" />
              </div>
              <div class="form-group">
                <label>Địa chỉ:</label>
                <input type="text" name="settingAddress" class="form-control" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12">
      <div>
        <button type="button" class="btn btn-success" onclick="saveSetting()">Lưu</button>
      </div>
    </div>
  </div>
</form>
<div id="load_page"></div>
<script>
    $(document).ready(function () {
        // Gọi API để lấy giá trị từ server
        $.get("http://localhost:2009/api/setting/get", function (data) {
            // Cập nhật giá trị trong view
            $("input[name='settingTitle']").val(data.settingTitle);
            $("input[name='settingLogo']").val(data.settingLogo);
            $("input[name='settingHotline']").val(data.settingHotline);
            $("input[name='settingEmail']").val(data.settingEmail);
            $("input[name='settingAddress']").val(data.settingAddress);
        });
    });
		var button1 = document.getElementById( 'ckfinder-popup-1' );

      button1.onclick = function() {
          selectFileWithCKFinder( 'settingLogo' );
      };

      function selectFileWithCKFinder( elementId ) {
          CKFinder.popup( {
              chooseFiles: true,
              width: 800,
              height: 600,
              onInit: function( finder ) {
                  finder.on( 'files:choose', function( evt ) {
                      var file = evt.data.files.first();
                      var output = document.getElementById( elementId );
                      output.value = file.getUrl();
                  } );

                  finder.on( 'file:choose:resizedImage', function( evt ) {
                      var output = document.getElementById( elementId );
                      output.value = evt.data.resizedUrl;
                  } );
              }
          } );
      }
    function saveSetting() {
        // Lấy giá trị từ form
        var settingData = {
            settingTitle: $("input[name='settingTitle']").val(),
            settingLogo: $("input[name='settingLogo']").val(),
            settingHotline: $("input[name='settingHotline']").val(),
            settingEmail: $("input[name='settingEmail']").val(),
            settingAddress: $("input[name='settingAddress']").val()
        };

        // Gọi API để lưu giá trị vào cơ sở dữ liệu
        $.ajax({
            url: "http://localhost:2009/api/setting/add",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(settingData),
            success: function (response) {
                // Xử lý thành công
                console.log(response);
                alert("Lưu thành công!");
            },
            error: function (error) {
                // Xử lý lỗi
                console.log(error);
                alert("Lỗi khi lưu cấu hình!");
            }
        });
    }
</script>
</body>
